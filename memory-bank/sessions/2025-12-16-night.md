# Session 2025-12-16 Night
*Created: 2025-12-16 22:19:00 IST*
*Last Updated: 2025-12-16 22:19:00 IST*

## Focus Task
T24: Migrate from better-sqlite3 to sql.js

## Work Summary
- Made mb-cli the single source of truth for the standalone database server/template via `mb-cli/src/server-package/`
- Added `mb-cli/src/sync-database-template.js` to sync canonical server-package -> `mb-cli/templates/memory-bank/database/`
- Completed key sql.js migration correctness fixes (dirty flag persistence, better-sqlite3-compatible `lastInsertRowid`, transaction await fixes)
- Fixed `mb init --interactive` viewer copy behavior (`setupViewer` flag)
- Added `pnpm-workspace.yaml` to generated database package to prevent monorepo workspace hijack

## Key Decisions
- Treat `mb-cli/src/server-package/` as canonical; templates are generated artifacts
- Avoid writing `memory_bank.db` on close unless writes occurred (sql.js in-memory persistence)

## Files Changed
- mb-cli/src/server-package/lib/sqlite.js
- mb-cli/src/server-package/server.js
- mb-cli/src/server-package/init-schema.js
- mb-cli/src/server-package/pnpm-workspace.yaml
- mb-cli/src/sync-database-template.js
- mb-cli/src/commands/init.js
- mb-cli/package.json
- mb-cli/templates/memory-bank/database/ (synced output)

## Next Steps
- Run clean install tests in a fresh repo and a pnpm monorepo
- Finish any remaining parser/query script correctness issues (if any)
