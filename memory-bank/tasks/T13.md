# T13: Implement Memory Bank CLI
*Last Updated: 2025-12-16 14:25:03 IST*

**Description**: Design and implement a Command Line Interface (CLI) for Memory Bank to replace the current manual copy-paste workflow. The CLI will provide standardized commands for managing tasks, sessions, and project structure, making the system more user-friendly and reducing potential errors.

**Status**: ðŸ”„ In Progress (90% - Parser execution and modular refactor complete)
**Priority**: HIGH
**Started**: May 17, 2025
**Last Active**: 2025-12-16 14:25:03 IST
**Dependencies**: T12 (Documentation needs to be updated once CLI is implemented)

## Completion Criteria
- CLI provides all core Memory Bank functionality:
  - Project initialization (`mb init`)
  - Task management (`mb task`)
  - Session management (`mb session`)
  - File operations (`mb file`)
  - Memory Bank updates (`mb update`)
- Automated template creation and management
- Interactive mode for complex operations
- Proper error handling and validation
- Built-in help system
- Shell completion support
- Configuration management

## Related Files
- `memory-bank/implementation-details/cli-architecture.md` (Created May 18, 2025)
- `memory-bank/implementation-details/cli-command-specification.md` (Created May 18, 2025)
- `memory-bank/implementation-details/cli-implementation-details.md` (Updated May 18, 2025)
- `docs/getting-started.html`
- `docs/integrated-rules.md`
- `docs/memory-bank-rules.md`
- Templates in `memory-bank/templates/`
- All task-related files that will need CLI integration

## Progress
1. âœ… Design CLI architecture and command structure (May 18, 2025)
   - Created detailed architecture documentation
   - Defined component interactions
   - Established data flow patterns
2. âœ… Define command specifications and options (May 18, 2025)
   - Documented all commands and their behavior
   - Defined error scenarios
   - Specified command options and flags
3. âœ… Create basic CLI framework (May 18, 2025)
   - Set up Commander.js-based CLI structure
   - Implemented project structure with src/commands/
   - Created command routing system
4. âœ… Implement init command with database templates (Nov 11, 2025)
   - Fixed package.json generation with complete JSON template
   - Added database files: .env, schema.prisma, pnpm-lock.yaml
   - Generated README.md for memory-bank/ with onboarding
   - Generated DATABASE_README.md with complete setup documentation
   - Implemented existing memory bank detection with --force override
   - All timestamps using IST timezone (Asia/Kolkata)

5. âœ… Refactor init command for code quality (Nov 11, 2025 18:02:49 IST)
   - Extracted timestamp utility function (getISTTimestamp) eliminating duplication
   - Refactored content generators into focused functions
   - Added initial content to core files:
     * tasks.md with template and registry structure
     * projectbrief.md with project overview template
     * session_cache.md with session tracking template
     * .cursorrules with development guidelines template
   - Improved code maintainability and extensibility
   - Backup created: init.js.backup

6. âœ… Fix critical timezone handling in migration scripts (Nov 11, 2025 18:15:00 IST)
   - Fixed convert.js date parsing to handle any timezone abbreviation (IST, UTC, EST, PST, etc.)
   - Replaced IST-hardcoded timestamp function with timezone-agnostic implementation
   - Updated init.js to auto-detect user's timezone instead of defaulting to IST
   - All timestamps now use user's local timezone
   - Verified with convert.js running on existing project - no timezone errors

7. âœ… Include migration scripts in new memory banks (Nov 11, 2025 18:18:00 IST)
   - Added MIGRATION_SCRIPT_FILES array to init.js
   - Migration scripts now automatically copied to new memory banks
   - Fallback generation of migration_guide.md if source unavailable
   - Users can immediately run migration scripts after init

8. âœ… Implement selective initialization system (Nov 11, 2025 18:24:10 IST)
   - Added scanExistingContent() to detect partial memory banks
   - Added promptForSelectiveInit() to show user options
   - Added determineComponentsToInit() for smart component selection
   - New flags: --core, --templates, --database, --full, --skip-existing
   - Non-destructive by default (skips existing files)
   - Behavior: Without flags on existing MB, shows options; with flags, initializes selectively
   - Added comprehensive help documentation with examples
   - Clear [+] created / [âœ“] skipped status indicators in output

9. âœ… Real-world integration testing (2025-11-11 19:43:25 IST)
   - Tested init with --database flag in new project directory (/Users/deepak/code/digitalocean-server/)
   - Verified setupDatabase() automation works end-to-end without manual pnpm/migration
   - Tested confirmation prompt showing target directory paths correctly
   - Identified schema/convert.js field mismatches during migration execution
   - Confirmed Prisma model fields don't fully align with convert.js query expectations
   - Documented issues discovered for Phase 2 schema correction work

10. âœ… Integration with T20 SQLite parser system (2025-11-12 16:59:56 IST)
   - Backed up old Prisma-based init.js as init.js.prisma-backup
   - Created new init.js compatible with T20 better-sqlite3 parser approach
   - Removed Prisma ORM dependencies (@prisma/client, prisma)
   - Updated package.json generation to use better-sqlite3 instead
   - Integrated migration script copying from memory-bank/database/ source
   - Updated DATABASE_README.md to document SQLite parser approach
   - Tested with digitalocean-server project initialization
   - System now supports both format styles (with/without timezone in edit entries)
   - Status: T13 fully integrated with new T20 database system

11. âœ… Template canonicalization and init fixes (2025-12-16 14:25:03 IST)
   - Canonical template sources moved under `mb-cli/templates/` (database toolchain + memory-bank/templates)
   - `mb init` now copies full template contents into `memory-bank/templates/` (no empty placeholders)
   - `mb init` targetDir auto-detection prevents nested memory-bank directories when run from inside memory-bank/ or memory-bank/database/

## Next Phase: Core Commands
6. â¬œ Implement remaining core commands (Phase 4)
   - â¬œ mb task (Task management)
   - â¬œ mb session (Session management)
   - â¬œ mb file (File operations)
7. â¬œ Add template management system
8. â¬œ Implement configuration management
9. â¬œ Add interactive mode
10. â¬œ Add help system and documentation
11. â¬œ Add shell completion
12. â¬œ Write tests
13. â¬œ Create distribution package
14. â¬œ Update system documentation for CLI

## Context
The current Memory Bank system relies on manual file creation and copy-paste operations, which can be error-prone and time-consuming. A CLI will standardize these operations, making the system more accessible and reliable. Key features needed:

### Command Structure
```bash
mb init                          # Initialize new project
mb task create "Task name"      # Create new task
mb task list                    # List all tasks
mb task show T13               # Show task details
mb task update T13 --status="in-progress"  # Update task
mb session start               # Start new session
mb session cache              # Cache current session
mb session complete          # Complete current session
```

### Template Management
- Automated creation of task files
- Session file management
- Project structure initialization
- Configuration file handling

### Interactive Mode
- Guided project setup
- Task creation wizard
- Session management prompts
- Configuration assistance

### Configuration
- Project-specific settings
- User preferences
- GitHub integration settings
- Custom template locations
- Default values

### Key Requirements
1. Must maintain current system's flexibility
2. Should follow KIRSS principle
3. Must handle all current file operations
4. Should provide validation and error checking
5. Must be backward compatible with existing projects
6. Should support both interactive and command modes

### Implementation Notes
- Use a modern CLI framework (e.g., Commander.js, Yargs)
- Follow Unix CLI conventions
- Provide clear, helpful error messages
- Include progress indicators for long operations
- Support both novice and expert users
- Maintain idempotency where possible

## Task Checklist
1. [x] Create CLI architecture documentation
2. [x] Create command specifications
3. [x] Update implementation plan
4. [x] Research and select CLI framework
   - [x] Evaluate options (Commander.js, Yargs, etc.)
   - [x] Selected Commander.js for simplicity
   - [x] Document selection rationale
5. [x] Implement basic framework
   - [x] Set up project structure
   - [x] Create command routing
   - [x] Basic error handling setup
6. [x] Implement init command (complete)
   - [x] Project validation
   - [x] Directory creation
   - [x] Template setup with database files
   - [x] Fixed package.json with proper JSON structure
   - [x] Added .env with SQLite configuration
   - [x] Added schema.prisma template
   - [x] Added pnpm-lock.yaml template
   - [x] Created memory-bank/ README.md with onboarding
   - [x] Created database/ DATABASE_README.md with full documentation
   - [x] Implemented existing memory bank detection with --force option
7. [ ] Implement remaining core commands
   - [ ] mb task commands
   - [ ] mb session commands
   - [ ] mb file commands
8. [ ] Add advanced features
9. [ ] Create tests and documentation
10. [ ] Prepare for distribution

### Recent Progress Notes
**May 18, 2025:**
- Completed detailed CLI architecture design
- Created comprehensive command specifications
- Refined implementation plan with detailed checklist
- Selected Commander.js as CLI framework
- Implemented basic CLI structure with init command
- Added dry-run support for safer initialization

**November 11, 2025 (Session 18:02-18:24 IST):**
- Phase 1: Fixed T3 database migration issues
  * Fixed convert.js to strip timezone abbreviations before parsing dates
  * Updated init.js getCurrentTimestamp() to use user's timezone instead of IST
  * Added migration scripts to init output - convert.js, verify.js, seed.js now included
  * Verified 364 database records converted successfully with zero errors
  
- Phase 2: Implemented selective initialization (NEW)
  * Added detection of partial memory banks with scanExistingContent()
  * Created smart initialization logic that respects existing files
  * Implemented new command flags: --core, --templates, --database, --full, --skip-existing
  * Default behavior: non-destructive (skips existing, initializes missing)
  * When memory bank exists without flags: shows options and exits safely
  * Added comprehensive help with 7 practical examples
  * Output now shows [+] for created files, [âœ“] for skipped existing
  * Users can now incrementally enhance existing memory banks
  
- Code quality improvements:
  * Strategic use of block edits instead of full rewrites
  * Kept changes minimal and focused
  * Maintained backward compatibility
  * All new functionality fully tested and documented in help system

**November 27, 2025 (Session 16:13-16:55 IST):**
- CLI Parser Fixes & Modularization:
  * Fixed parse operation exclusive checks (removed --core/--templates/--database/--viewer exclusions)
  * Fixed startViewer operation exclusive checks for consistency
  * Updated PARSER_SCRIPTS to include all 4 parsers: parse-edits.js, parse-tasks.js, parse-sessions.js, parse-session-cache.js
  * Implemented actual parser execution in option 4 (was only showing instructions)
  * Added auto-dependency installation if node_modules missing
  * Added sequential parser execution with progress output
  * Parser validates all required files before execution
  * Copied all parser scripts to T21 folder for consistency
  * Fixed component summary display to show multiple target directories
  
- Server.js Improvements:
  * Changed default database from test_memory_bank.db to memory_bank.db
  * Added --help flag with comprehensive usage documentation
  * Added --port flag for custom port configuration
  * Enhanced database path handling with better error messages
  
- Bug Fixes:
  * Fixed CSS file path mismatch (styles.css â†’ style.css)
  * Corrected VIEWER_PUBLIC_FILES constant to match actual filenames
  
- Modular Architecture (Phase 1):
  * Created lib/ directory structure
  * Extracted validators.js (scanExistingContent, validate functions)
  * Extracted parsers.js (installDependencies, runParsers, displayParserResults)
  * Extracted prompts.js (promptForSelectiveInit, promptForInteractiveSetup, confirmInitialization)
  * Extracted writers.js (all template generation functions, getCurrentTimestamp)
  * Full refactor of init.js to use modules deferred to next session